@using static Microsoft.AspNetCore.Components.Web.RenderMode
@rendermode InteractiveServer
 
@using Microsoft.AspNetCore.Components.QuickGrid

@namespace SmartEstimate.Pages

@page "/"
@page "/quotes"
  

<div class="flex flex-col h-full">
    <Search />
    <div class="container flex flex-col flex-1 justify-between bg-gray-100 h-full py-10">
        <div class="flex flex-col">
            <ContentViewHeader 
                Title="Quotes"
                Description="A list of all your quotes including their name, sales associate and created and last updated dates"
                ButtonLabel="Add Quote"
                OnClick=AddQuote
                Class="mb-6"
            />

            @if(IsLoading) {
                <Spinner Class="text-stone-400 dark:text-stone-400 fill-orange-600" />
            } else if(!_quotes.Any()) {
                <span>No Quotes Available</span>
            } else {  
                <QuickGrid Items=_quotes Pagination=@_pagination>
                    <TemplateColumn               
                        Title="Name"
                        SortBy=@_sortByName
                        Sortable=true 
                    >
                        <NavLink href=@($"/quotes/{context.Id}")>
                            @context.Name
                        </NavLink>
                    </TemplateColumn>
                    <PropertyColumn 
                        Title="Status"
                        Property=@(q => q.Status)
                        Sortable=true
                    />
                    <PropertyColumn 
                        TGridItem=QuoteView 
                        TProp=string 
                        Title="Sales Associate"
                        Property=@(q => q.SalesAssociate)
                        Sortable=true
                    />
                    <PropertyColumn 
                        Title="Last Updated"
                        Property=@(q => q.UpdatedAt)
                        Format="HH:mm tt MMMM d, yyyy"
                        Sortable=true 
                    />
                    <TemplateColumn 
                        Class="flex gap-x-2 justify-end"
                    >
                        <button class="w-[22px] cursor-pointer" onclick=@(() => DeleteQuote(context.Id))>
                            <TrashIcon Props=@(new IconProps() 
                                { 
                                    Class = $@"
                                        stroke-gray-400 
                                        hover:stroke-red-500 
                                        transition ease-in duration-200
                                    "
                                }) 
                            />
                        </button>         
                    </TemplateColumn>
                </QuickGrid>
            }
        </div>
                
        <Paginator State=@_pagination />
   </div>
</div>

@code {
    private PaginationState _pagination = new PaginationState { ItemsPerPage = 10 };
    private GridSort<QuoteView> _sortByName = GridSort<QuoteView>
        .ByAscending(q => q.Name);
}