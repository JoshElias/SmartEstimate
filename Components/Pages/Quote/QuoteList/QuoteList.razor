@using static Microsoft.AspNetCore.Components.Web.RenderMode
@rendermode InteractiveServer
@using SmartEstimate.Animation
@using SmartEstimate.Icons

@page "/"
@page "/quotes"


@namespace SmartEstimate.Pages

<div class="
    sticky top-0 z-40 
    flex h-16 
    shrink-0 items-center 
    gap-x-6 
    border-b border-white/5 
    bg-stone-600 
    text-stone-200
    placeholder:text-stone-300
    px-4 
    shadow-sm 
    sm:px-6 lg:px-8
">
  <button type="button" class="-m-2.5 p-2.5 text-white md:hidden">
    <span class="sr-only">Open sidebar</span>
    <SearchIcon Class="w-4 stroke-stone-300" />
  </button>

  <div class="flex flex-1 gap-x-4 self-stretch lg:gap-x-6">
    <form class="flex flex-1" action="#" method="GET">
      <label for="search-field" class="sr-only">Search</label>
      <div class="relative w-full">
        <svg class="pointer-events-none absolute inset-y-0 left-0 h-full w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
          <path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z" clip-rule="evenodd" />
        </svg>
        <input id="search-field" class="block h-full w-full border-0 bg-transparent py-0 pl-8 pr-0 text-white focus:ring-0 sm:text-sm" placeholder="Search..." type="search" name="search">
      </div>
    </form>
  </div>
</div>
<div class="container bg-gray-100 h-full py-10 m-0">
    
    @if(IsLoading) {
        <Spinner Class="text-stone-400 dark:text-stone-400 fill-orange-600" />
    } else if(!_quotes.Any()) {
        <span>No Quotes Available</span>
    } else {
        <ContentViewHeader 
            Title="Quotes"
            Description="A list of all your quotes including their name, sales associate and created and last updated dates"
            ButtonLabel="Add Quote"
            OnClick=AddQuote
        />
        <DataGridWrapper>
            <DataGrid Items=_quotes>
                <PropertyColumn 
                    TGridItem=QuoteView
                    TProp=string
                    Title="Name"
                    Property=@(q => q.Name)
                    Sortable="true" 
                />
                <PropertyColumn 
                    TGridItem=QuoteView 
                    TProp=QuoteStatus
                    Title="Status"
                    Property=@(q => q.Status)
                    Sortable=true
                />
                <PropertyColumn 
                    TGridItem=QuoteView 
                    TProp=string 
                    Title="Sales Associate"
                    Property=@(q => q.SalesAssociate)
                    Sortable=true
                />
                <PropertyColumn 
                    TGridItem=QuoteView 
                    TProp=DateTime 
                    Title="Last Updated"
                    Property=@(q => q.UpdatedAt)
                    Format="HH:mm tt MMMM d, yyyy"
                    Sortable=true 
                />
                <TemplateColumn 
                    TGridItem=QuoteView 
                    Class="flex gap-x-2 justify-end"
                >
                    <NavLink href=@($"quotes/{context.Id}")>
                        <EditIcon Class="
                            w-[22px]
                            cursor-pointer 
                            stroke-gray-400
                            hover:stroke-sky-500 
                            duration-300 
                            ease-in-out" 
                        />
                    </NavLink>
                    <button onclick=@(() => DeleteQuote(context.Id))>
                        <TrashIcon Class="
                            w-[22px]
                            cursor-pointer 
                            stroke-gray-400
                            hover:stroke-rose-500 
                            duration-300 
                            ease-in-out" 
                        />
                    </button>         
                </TemplateColumn>
            </DataGrid>
        </DataGridWrapper>
    }
</div>