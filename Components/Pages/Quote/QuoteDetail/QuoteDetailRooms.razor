
@namespace SmartEstimate.Pages

@using Microsoft.AspNetCore.Components.QuickGrid

@inject QuoteStore _quoteStore


 @if(IsLoading) {
        <Spinner Class="text-stone-400 dark:text-stone-400 fill-orange-600" />
    } else if(!_roomsQueryable.Any()) {
        <span>No Quotes Available</span>
    } else {
        <ContentViewHeader 
            Title="Rooms"
            Description="We heard you like rooms"
            ButtonLabel="Add Room"
        />
        <DataGridWrapper>
            <DataGrid Items=_roomsQueryable>
                <PropertyColumn 
                    TGridItem=RoomView
                    TProp=string
                    Title="Name"
                    Property=@(r => r.Name)
                    Sortable="true" 
                />
                <PropertyColumn 
                    TGridItem=RoomView 
                    TProp=string
                    Title="Door Style"
                    Property=@(r => r.DoorStyle.Name)
                    Sortable=true
                />
                <PropertyColumn 
                    TGridItem=RoomView 
                    TProp=string 
                    Title="Finish"
                    Property=@(r => r.Finish.Name)
                    Sortable=true
                />
                <PropertyColumn 
                    TGridItem=RoomView 
                    TProp=string 
                    Title="Interior"
                    Property=@(r => r.Interior.Name)
                    Sortable=true 
                />
                <PropertyColumn 
                    TGridItem=RoomView 
                    TProp=string 
                    Title="Drawer Hardware"
                    Property=@(r => r.DrawerHardware.Name)
                    Sortable=true 
                />
                <PropertyColumn 
                    TGridItem=RoomView 
                    TProp=float 
                    Title="Drawer Hardware"
                    Property=@(r => r.SubTotal)
                    Format="C"
                    Sortable=true 
                />
                <TemplateColumn 
                    TGridItem=RoomView 
                    Class="flex gap-x-2 justify-end"
                >
                    <NavLink href=@($"quotes/{QuoteId}/rooms/{context.Id}")>
                        <EditIcon Class="
                            w-[22px]
                            cursor-pointer 
                            stroke-gray-400
                            hover:stroke-sky-500 
                            duration-300 
                            ease-in-out" 
                        />
                    </NavLink>
                    <button>
                        <TrashIcon Class="
                            w-[22px]
                            cursor-pointer 
                            stroke-gray-400
                            hover:stroke-rose-500 
                            duration-300 
                            ease-in-out" 
                        />
                    </button>         
                </TemplateColumn>
            </DataGrid>
        </DataGridWrapper>
    } else {
        <span>No Quotes Available</span>
    }


@code {
    private bool IsLoading { get; set; } = true;

    [Parameter]
    public int QuoteId { get; set; }

    private QuoteView _quote = new();
    private IQueryable<RoomView> _roomsQueryable = new List<RoomView>().AsQueryable();

    protected override async Task OnInitializedAsync()
    {
        _quote = await _quoteStore.ReadableStore.GetById(QuoteId);
        _roomsQueryable = _quote.Rooms.AsQueryable();
        IsLoading = false;
    }
}